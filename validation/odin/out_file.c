#ifndef_eit_h_include_#define_eit_h_include_//_nolintbegin(misc_definitions_in_headers)_//_warn:_do_not_remove_any_includes_without_first_checking_if_they_are_used_in_the_implementation_//_part_by_uncommenting_#define_eit_h_implementation_(and_remember_to_comment_it_out_again_//_afterwards,_#include_<assert.h>_#include_<ctype.h>_#include_<errno.h>_#include_<fcntl.h>_#include_<float.h>_#include_<math.h>_#include_<pthread.h>_#include_<stdarg.h>_#include_<stdint.h>_#include_<stdio.h>_#include_<stdlib.h>_#include_<string.h>_#include_<sys/mman.h>_#include_<sys/stat.h>_#include_<time.h>_#include_<unistd.h>_#if_!defined(_cplusplus)_#include_<stdbool.h>_#endif_////////////////////////////////////////_//_defines_//_////////////////////////////////////////_//_note(ingar):_prevents_the_formatter_from_indenting_everything_inside_the_"c"_block_#if_defined(_cplusplus)_#define_eit_begin_extern_c_extern_"c"_{_#define_eit_end_extern_c_}_#else_#define_eit_begin_extern_c_#define_eit_end_extern_c_#endif_#if_defined(_cplusplus)_eit_begin_extern_c_#endif_#define_sdb_internal_static_#define_sdb_persist_static_#define_sdb_global_static_typedef_uint8_t_u8;_typedef_uint16_t_u16;_typedef_uint32_t_u32;_typedef_uint64_t_u64;_typedef_int8_t_i8;_typedef_int16_t_i16;_typedef_int32_t_i32;_typedef_int64_t_i64;_/**_*_sdb_errno_is_a_custom_type_to_represent_error_and_success_codes_in_systems_using_eit_._*_values_>=_0_indicate_success,_while_values_<_0_indicate_errors._*_*_generic_success_is_defined_as_0,_and_generic_error_is_defined_as_1._*_custom_errno_codes_can_be_defined_in_the_below_enum._*_*_when_appropriate,_negative_posix_errno_values_can_be_returned,_*_e.g._einval._*/_//_todo(ingar):_check_number_range_for_posix_errno_codes_and_make_sure_they_don't_overlap_with_ours_typedef_int_least32_t_sdb_errno;_enum_{_eite_success_=_0,_eite_err_=_1,_eite_dbs_unavail_=_2,_eite_cp_unavail_=_3,_eite_conn_closed_sucs_=_4,_eite_conn_closed_err_=_5,_eite_pg_err_=_6,_eite_json_err_=_7,_eite_ptr_was_null_=_8,_};_static_inline_const_char_*eit_str_err(sdb_errno_e)_{_if_(e_<_0)_{_e_=_e;_}_switch_(e)_{_case_eite_success:_return_"success";_case_eite_err:_return_"error";_case_eite_dbs_unavail:_return_"database_system_unavailable";_case_eite_cp_unavail:_return_"communication_protocol_unavailable";_case_eite_conn_closed_sucs:_return_"connection_closed_successfully";_case_eite_conn_closed_err:_return_"connection_closed_with_error";_case_eite_pg_err:_return_"postgre_sql_error";_case_eite_json_err:_return_"json_parsing_error";_case_eite_ptr_was_null:_return_"pointer_was_null";_default:_return_"unknown_error";_}_}_#define_eit_expand(x)_x_#define_eit_stringify_(x)_#x_#define_eit_stringify(x)_eit_stringify_(x)_#define_eit_concat2_(x,_y)_x##y_#define_eit_concat2(x,_y)_eit_concat2_(x,_y)_#define_eit_concat3_(x,_y,_z)_x##y##z_#define_eit_concat3(x,_y,_z)_eit_concat3_(x,_y,_z)_#define_eit_kilo_byte(number)_(number_*_1000ull)_#define_eit_mega_byte(number)_(sdb_kilo_byte(number)_*_1000ull)_#define_eit_giga_byte(number)_(sdb_mega_byte(number)_*_1000ull)_#define_eit_tera_byte(number)_(sdb_giga_byte(number)_*_1000ull)_#define_eit_kibi_byte(number)_(number_*_1024ull)_#define_eit_mebi_byte(number)_(sdb_kibi_byte(number)_*_1024ull)_#define_eit_gibi_byte(number)_(sdb_mebi_byte(number)_*_1024ull)_#define_eit_tebi_byte(number)_(sdb_gibi_byte(number)_*_1024ull)_#define_eit_array_len(array)_(sizeof(array)_/_sizeof(array[0]))_#define_eit_max(a,_b)_((a_>_b)_?_a_:_b)_#define_eit_min(a,_b)_((a_<_b)_?_a_:_b)_bool_eit_double_epsilon_compare(const_double_a,_const_double_b);_u64_eit_double_sign_bit(double_f);_double_eit_radians_from_degrees(double_degrees);_size_t_eit_mem_size_from_string(const_char_*size_str);_////////////////////////////////////////_//_logging_//_////////////////////////////////////////_/*_based_on_the_logging_frontend_i_wrote_for_oec_*/_#if_!defined(eit_log_buf_size)_#define_eit_log_buf_size_2048_#endif_static_assert(eit_log_buf_size_>=_128,_"eit_log_buf_size_must_greater_than_or_equal_to_128!");_#define_eit_log_level_none_(0u)_#define_eit_log_level_err_(1u)_#define_eit_log_level_wrn_(2u)_#define_eit_log_level_inf_(3u)_#define_eit_log_level_dbg_(4u)_#if_!defined(eit_log_level)_#define_eit_log_level_3_#endif_#if_eit_log_level_>=_4_&&_eit_printf_debug_enable_==_1_#define_eit_printf_debug(...)_printf(_va_args_);_#else_#define_eit_printf_debug(...)_#endif_typedef_struct_sdb_log_module_{_const_char_*name;_u64_buffer_size;_char_*buffer;_pthread_mutex_t_lock;_}_sdb_log_module_;_i64_eit_write_log_(sdb_log_module_*module,_const_char_*log_level,_const_char_*fmt,_...)_attribute_((format(printf,_3,_4)));_#define_eit_log_level_check_(level)_(eit_log_level_>=_eit_log_level_##level)_#define_eit_logging_not_used_\_static_sdb_log_module_*eit_log_instance_\_attribute_((used))_=_null_#define_eit_log_register(module_name)_\_static_char_eit_concat3(eit_log_module,_module_name,_\_buffer_)[eit_log_buf_size];_\_sdb_log_module_eit_concat3(eit_log_module,_module_name,_\_)_attribute_((used))_=_{_\_.name_=_eit_stringify(module_name),_\_.buffer_size_=_eit_log_buf_size,_\_.buffer_=_eit_concat3(eit_log_module,_module_name,_buffer_),_\_.lock_=_pthread_mutex_initializer_\_};_\_static_sdb_log_module_*eit_log_instance_attribute_((used))_=_\_&eit_concat3(eit_log_module,_module_name,_)_#define_eit_log_declare(name)_\_extern_sdb_log_module_eit_concat3(eit_log_module,_name,_);_\_static_sdb_log_module_*eit_log_instance_attribute_((used))_=_\_&eit_concat3(eit_log_module,_name,_)_#define_eit_log_(log_level,_fmt,_...)_\_do_{_\_if_(eit_log_level_check_(log_level))_{_\_sdb_errno_log_ret_=_eit_write_log_(_\_sdb_log_instance_,_eit_stringify(log_level),_\_fmt,_##_va_args_);_\_assert(log_ret_>=_0);_\_}_\_}_while_(0)_#define_eit_log_debug(...)_eit_log_(dbg,_##_va_args_)_#define_eit_log_info(...)_eit_log_(inf,_##_va_args_)_#define_eit_log_warning(...)_eit_log_(wrn,_##_va_args_)_#define_eit_log_error(...)_eit_log_(err,_##_va_args_)_#if_eit_assert_==_1_#define_eit_assert(condition,_fmt,_...)_\_do_{_\_if_(!(condition))_{_\_eit_write_log_(sdb_log_instance_,_"dbg",_\_"assert_(%s,%d):_"_fmt,_func_,_\_line_,_##_va_args_);_\_assert(condition);_\_}_\_}_while_(0)_#else_#define_eit_assert(...)_#endif_////////////////////////////////////////_//_memory_//_////////////////////////////////////////_typedef_struct_sdb_slice_{_u64_len;_u64_e_size;_u8_*mem;_}_sdb_slice;_typedef_struct_sdb_arena_{_u64_cur;_u64_cap;_u8_*mem;_}_sdb_arena;_typedef_struct_{_sdb_arena_*arena;_u64_f5;_}_sdb_scratch_arena;_typedef_struct_{_sdb_arena_**arenas;_u64_count;_u64_max_count;_}_sdb_thread_arenas_;_#define_eit_thread_arenas_register(thread_name,_count)_\_static_thread_sdb_arena_*eit_concat3(eit_thread_arenas,_\_thread_name,_buffer_)[count]_\_attribute_((used));_\_thread_sdb_thread_arenas_eit_concat3(eit_thread_arenas,_\_thread_name,_)_\_attribute_((used))_=_{_.arenas_=_null,_\_.count_=_0,_\_.max_count_=_count_};_\_static_thread_sdb_thread_arenas_*eit_thread_arenas_instance_\_attribute_((used))_#define_eit_thread_arenas_extern(thread_name)_\_extern_thread_sdb_thread_arenas_eit_concat3(eit_thread_arenas,_\_thread_name,_);_\_static_thread_sdb_thread_arenas_*eit_thread_arenas_instance_\_attribute_((used))_//_warn:_must_be_used_at_runtime,_not_compile_time._this_is_because_you_cannot_take_the_address_//_of_a_thread_varible_in_static_initialization,_since_the_address_will_differ_per_thread._void_eit_thread_arenas_init_(sdb_arena_*ta_buf[],_sdb_thread_arenas_*t_as,_sdb_thread_arenas_**ta_instance);_#define_eit_thread_arenas_init(thread_name)_\_eit_thread_arenas_init_(_\_eit_concat3(sdb_thread_arenas,_thread_name,_buffer_),_\_&eit_concat3(eit_thread_arenas,_thread_name,_),_\_&eit_thread_arenas_instance_)_void_eit_thread_arenas_init_extern_(sdb_thread_arenas_*t_as,_sdb_thread_arenas_**ta_instance);_#define_eit_thread_arenas_init_extern(thread_name)_\_eit_thread_arenas_init_extern_(&eit_concat3(sdb_thread_arenas,_\_thread_name,_),_\_&eit_thread_arenas_instance_)_sdb_errno_eit_thread_arenas_add_(sdb_arena_*arena,_sdb_thread_arenas_*ta_instance);_#define_eit_thread_arenas_add(arena)_\_sdb_thread_arenas_add_(arena,_sdb_thread_arenas_instance_)_sdb_scratch_arena_eit_scratch_begin(sdb_arena_*arena);_sdb_scratch_arena_eit_scratch_get_(sdb_arena_**conflicts,_u64_conflict_count,_sdb_thread_arenas_*t_as);_#define_eit_scratch_get(conflicts,_conflict_count)_\_eit_scratch_get_(conflicts,_conflict_count,_\_sdb_thread_arenas_instance_)_void_eit_scratch_release_(sdb_scratch_arena_scratch);_#define_eit_scratch_release(scratch)_sdb_scratch_release_(scratch)_sdb_scratch_arena_eit_scratch_begin(sdb_arena_*arena);_void_eit_mem_zero(void_*mem,_u64_size);_void_eit_mem_zero_secure(void_*mem,_u64_size);_#define_eit_mem_zero_struct(struct)_sdb_mem_zero(struct,_sizeof(*struct))_#define_eit_mem_zero_struct_secure(struct)_\_sdb_mem_zero_secure(struct,_sizeof(*struct))_void_*eit_memcpy(void_*_restrict_to,_const_void_*_restrict_from,_size_t_len);_void_*eit_memset(void_*_restrict_data,_int_set_to,_size_t_len);_bool_eit_memcmp(const_void_*lhs,_const_void_*rhs,_size_t_len);_void_eit_arena_init(sdb_arena_*arena,_u8_*mem,_u64_size);_sdb_arena_*eit_arena_bootstrap(sdb_arena_*arena,_sdb_arena_*new_arena_,_u64_size);_void_*eit_arena_push(sdb_arena_*arena,_u64_size);_void_*eit_arena_push_zero(sdb_arena_*arena,_u64_size);_void_*eit_arena_pop(sdb_arena_*arena,_u64_size);_u64_eit_arena_remaining(sdb_arena_*arena);_u64_eit_arena_get_pos(sdb_arena_*arena);_void_*eit_arena_seek(sdb_arena_*arena,_u64_pos);_u64_eit_arena_reserve(sdb_arena_*arena,_u64_size);_void_eit_arena_clear(sdb_arena_*arena);_void_eit_arena_clear_zero(sdb_arena_*arena);_#define_eit_push_array(arena,_type,_count)_\_(type_*)sdb_arena_push(arena,_sizeof(type)_*_(count))_#define_eit_push_array_zero(arena,_type,_count)_\_(type_*)sdb_arena_push_zero(arena,_sizeof(type)_*_(count))_#define_eit_push_struct(arena,_type)_sdb_push_array(arena,_type,_1)_#define_eit_push_struct_zero(arena,_type)_sdb_push_array_zero(arena,_type,_1)_void_eit_array_shift(void_*mem,_u64_from,_u64_to,_u64_count,_u64_element_size);_#define_eit_array_delete_and_shift(mem,_i,_count,_esize)_\_sdb_array_shift(mem,_(i_+_1),_i,_count,_esize)_#define_eit_pool_allocator_define(type_name,_func_name)_\_typedef_struct_type_name##_pool_{_\_sdb_arena_*arena;_\_type_name_*first_free;_\_}_type_name##_pool;_\_\_type_name_*func_name##alloc(type_name##_pool_*pool)_\_{_\_type_name_*result_=_pool_>first_free;_\_if_(result)_{_\_pool_>first_free_=_pool_>first_free_>next;_\_eit_mem_zero_struct(result);_\_}_else_{_\_result_=_eit_push_struct_zero(pool_>arena,_type_name);_\_}_\_\_return_result;_\_}_\_\_void_func_name##release(type_name##_pool_*pool,_type_name_*instance)_\_{_\_instance_>next_=_pool_>first_free;_\_pool_>first_free_=_instance;_\_}_////////////////////////////////////////_//_strings_//_////////////////////////////////////////_//_note(ingar):_these_are_libc_equivalents_and_are_intended_to_be_used_with_regular_c_strings,_not_//_sdb_strings_u64_eit_strnlen(const_char_*string,_u64_max);_u64_eit_strlen(const_char_*string);_char_*eit_strdup(char_*string,_sdb_arena_*arena);_//_based_on_ginger_bills_gb_string_implementation._//_//_a_few_assumptions_being_made:_//_the_strings_are_not_intended_to_be_reallocated_at_a_new_address._if_something_has_been_pushed_//_onto_the_arena,_and_you_use_a_function_that_increases_the_strings_length_or_capacity,_it_will_//_*not*_work_(at_least_for_the_moment)._//_//_the_way_it_works_is_that_sdb_string_functions_return_a_pointer_to_to_the_c_string,_which_is_//_always_null_terminated,_while_an_"invisible"_header_precedes_it_in_memory._the_advantage_of_this_//_is_that_an_sdb_string_can_be_passed_to_any_function_that_accepts_a_c_string,_and_it_will_work_//_correctly._this_avoids_the_typical_"improved_strings"_pattern_of_having_to_access_the_string_a_la_//_custom_string_>cstring._this_improves_the_ergonomics_of_sdb_strings,_and_also_improves_cache_//_behavior_since_the_header_and_the_c_string_are_always_contiguous_in_memory._typedef_char_*sdb_string;_typedef_struct_{_sdb_arena_*arena;_u64_len;_u64_cap;_}_sdb_string_header;_#define_eit_string_header(str)_((sdb_string_header_*)(str)_1)_u64_eit_string_len(sdb_string_string);_u64_eit_string_cap(sdb_string_string);_u64_eit_string_available_space(sdb_string_string);_u64_eit_string_alloc_size(sdb_string_string);_sdb_string_eit_string_make_space(sdb_string_string,_u64_add_len);_sdb_string_eit_string_make(sdb_arena_*a,_const_char_*string);_void_eit_string_free(sdb_string_string);_sdb_string_eit_string_duplicate(sdb_arena_*a,_const_sdb_string_string);_void_eit_string_clear(sdb_string_string);_sdb_string_eit_string_set(sdb_string_string,_const_char_*c_string);_void_eit_string_backspace(sdb_string_string,_u64_n);_sdb_string_eit_string_append(sdb_string_string,_sdb_string_other);_sdb_string_eit_string_append_c(sdb_string_string,_const_char_*other);_sdb_string_eit_string_append_fmt(sdb_string_string,_const_char_*fmt,_...)_attribute_((format(printf,_2,_3)));_bool_eit_strings_are_equal(sdb_string_lhs,_sdb_string_rhs);_////////////////////////////////////////_//_rng_//_////////////////////////////////////////_//_implementation_of_the_pcg_algorithm_(https://www.pcg_random.org)_//_it's_the_caller's_responsibilites_to_have_called_seed_rand_pcg_before_use_//_warn:_the_pcg_state_is_statically_allocated_inside_eit_get_pcg_state_,_and_is_not_protected_by_a_//_lock,_which_means_race_conditions_can_occurr_if_multiple_threads_use_it!_(though_maybe_this_//_actually_improves_unpredictability?)_u32_*eit_get_pcg_state_(void);_u32_eit_rand_pcg(void);_void_eit_seed_rand_pcg(uint32_t_seed);_/////////////////////////////////////////_//_file_io_//_/////////////////////////////////////////_typedef_struct_{_u64_size;_u8_data[];_}_sdb_file_data;_sdb_file_data_*eit_load_file_into_memory(const_char_*filename,_sdb_arena_*arena);_bool_eit_write_buffer_to_file(void_*buffer,_u64_element_size,_u64_element_count,_const_char_*filename);_bool_eit_write_sdb_file_data_to_file(sdb_file_data_*file_data,_const_char_*filename);_typedef_struct_{_void_*data;_//_mapped_memory_region_size_t_size;_//_size_of_mapping_int_fd;_//_file_descriptor_(kept_open_if_requested)_sdb_string_filename;_//_copy_of_filename_for_cleanup_int_flags;_//_saved_flags_for_cleanup_}_sdb_mmap;_/**_*_@brief_creates_a_memory_mapping_with_optional_file_backing_*_*_this_function_provides_a_convenient_wrapper_around_mmap()_with_integrated_file_handling._*_it_can_create_both_file_backed_and_anonymous_mappings,_with_various_protection_and_*_sharing_options._*_*_@param_map_pointer_to_the_sdb_mmap_that_will_be_filled_*_@param_m_addr_desired_mapping_address_(null_for_system_choice)_*_@param_m_size_size_of_the_mapping_in_bytes_*_@param_m_prot_memory_protection_flags_(can_be_combined_with_|):_*_prot_none_:_no_access_permitted_*_prot_read_:_pages_can_be_read_*_prot_write_:_pages_can_be_written_*_prot_exec_:_pages_can_be_executed_*_*_@param_m_flags_mapping_flags_(can_be_combined_with_|):_*_map_shared_:_updates_visible_to_other_processes_*_map_private_:_creates_copy_on_write_mapping_*_map_fixed_:_use_exact_address_(not_recommended)_*_map_anonymous_:_create_anonymous_mapping_(no_file_backing)_*_map_locked_:_lock_pages_into_memory_*_map_populate_:_populate_page_tables_*_map_noreserve_:_no_swap_space_reservation_*_map_hugetlb_:_use_huge_pages_*_*_@param_m_fd_file_descriptor_for_mapping:_*_>=_0_:_use_this_file_descriptor_*_1_:_used_with_map_anonymous_*_<_1_:_open_file_using_file_name,_o_flags,_and_o_mode_*_*_@param_m_offset_offset_into_file_(must_be_page_aligned)_*_*_@param_file_name_path_to_file_(used_only_if_m_fd_<_1)_*_*_@param_o_flags_file_open_flags_(used_only_if_m_fd_<_1),_can_combine_with_|:_*_required_one_of:_*_o_rdonly_:_read_only_*_o_wronly_:_write_only_*_o_rdwr_:_read_and_write_*_*_optional:_*_o_append_:_append_to_file_*_o_creat_:_create_if_not_exists_*_o_excl_:_with_o_creat:_fail_if_exists_*_o_trunc_:_truncate_to_m_size_(warn:_will_shrink_the_file_if_the_file's_size_*_is_>_m_size)_*_o_direct_:_direct_i/o_*_o_sync_:_synchronous_i/o_*_o_nofollow_:_don't_follow_symlinks_*_o_cloexec_:_close_on_exec_*_o_tmpfile_:_create_unnamed_temporary_file_*_*_@param_o_mode_file_creation_mode_(used_only_if_o_flags_includes_o_creat):_*_typical_values_(in_octal):_*_0644_:_user:_rw_,_group:_r_,_other:_r_*_0666_:_user:_rw_,_group:_rw_,_other:_rw_*_0600_:_user:_rw_,_group:_,_other:_*_0755_:_user:_rwx,_group:_r_x,_other:_r_x_*_*_individual_bits:_*_s_irusr_(0400)_:_user_read_*_s_iwusr_(0200)_:_user_write_*_s_ixusr_(0100)_:_user_execute_*_s_irgrp_(0040)_:_group_read_*_s_iwgrp_(0020)_:_group_write_*_s_ixgrp_(0010)_:_group_execute_*_s_iroth_(0004)_:_other_read_*_s_iwoth_(0002)_:_other_write_*_s_ixoth_(0001)_:_other_execute_*_*_special_bits:_*_s_isuid_(04000)_:_set_uid_bit_*_s_isgid_(02000)_:_set_gid_bit_*_s_isvtx_(01000)_:_sticky_bit_*_*_@return_sdb_errno:_*_0_on_success_*_negative_errno_value_on_failure:_*_eacces_:_permission_denied_*_eexist_:_file_exists_(with_o_creat_|_o_excl)_*_einval_:_invalid_arguments_*_enfile_:_system_file_table_full_*_enomem_:_out_of_memory_*_enoent_:_file_not_found_*_*_@note_*_the_map_structure_must_be_allocated_by_the_caller_*_file_name_string_must_remain_valid_throughout_the_mapping's_lifetime_*_file_descriptor_handling:_*_map_shared:_fd_kept_open_*_map_private:_fd_closed_after_mapping_*_map_anonymous:_fd_closed/ignored_*_the_actual_mapping_size_will_be_rounded_up_to_the_system_page_size_*_m_prot_permissions_must_be_compatible_with_o_flags_*_the_actual_protection_may_be_more_restrictive_than_m_prot_due_to_file_permissions_*_map_fixed_is_dangerous_and_should_be_avoided_*_file_permissions_are_masked_by_the_process_umask_*_some_combinations_may_not_be_supported_on_all_systems_*/_sdb_errno_eit_mem_map_(sdb_mmap_*map,_void_*m_addr,_size_t_m_size,_int_m_prot,_int_m_flags,_int_m_fd,_off_t_m_offset,_sdb_string_file_name,_int_o_flags,_mode_t_o_mode,_sdb_log_module_*module);_#define_eit_mem_map(map,_maddr,_msize,_mprot,_mflags,_mfd,_moffset,_filename,_\_oflags,_omode)_\_eit_mem_map_(map,_maddr,_msize,_mprot,_mflags,_mfd,_moffset,_\_filename,_oflags,_omode,_eit_log_instance_)_void_eit_mem_unmap(sdb_mmap_*map);_int_eit_mem_map_sync(sdb_mmap_*map);_int_eit_mem_map_advise(sdb_mmap_*map,_int_advice);_////////////////////////////////////////_//_"tokenizer"_//_////////////////////////////////////////_typedef_struct_{_char_*start;_u64_len;_}_sdb_token;_sdb_token_eit_get_next_token(char_**cursor);_////////////////////////////////////////_//_mem_trace_//_////////////////////////////////////////_void_*eit_malloc_trace_(size_t_size,_int_line,_const_char_*func,_sdb_log_module_*module);_void_*eit_calloc_trace_(u64_element_count,_u64_element_size,_int_line,_const_char_*func,_sdb_log_module_*module);_void_*eit_realloc_trace_(void_*pointer,_size_t_size,_int_line,_const_char_*func,_sdb_log_module_*module);_void_eit_free_trace_(void_*pointer,_int_line,_const_char_*func,_sdb_log_module_*module);_#if_eit_mem_trace_==_1_#define_malloc(size)_\_eit_malloc_trace_(size,_line_,_func_,_sdb_log_instance_)_#define_calloc(count,_size)_\_eit_calloc_trace_(count,_size,_line_,_func_,_sdb_log_instance_)_#define_realloc(pointer,_size)_\_eit_realloc_trace_(pointer,_size,_line_,_func_,_\_sdb_log_instance_)_#define_free(pointer)_\_eit_free_trace_(pointer,_line_,_func_,_sdb_log_instance_)_#endif_#if_defined(_cplusplus)_eit_end_extern_c_#endif_#endif_//_eit_h_include_//_warn:_only_one_file_in_a_program_should_define_eit_h_implementation,_otherwise_you_will_get_//_redefintion_errors_//_#define_eit_h_implementation_#ifdef_eit_h_implementation_//_note(ingar):_the_reason_this_is_done_is_so_that_functions_inside_eit_.h_don't_use_the_trace_//_macros._the_macros_are_redefined_at_the_bottom_#if_eit_mem_trace_==_1_#undef_malloc_#undef_calloc_#undef_realloc_#undef_free_#endif_////////////////////////////////////////_//_misc_//_////////////////////////////////////////_bool_eit_double_epsilon_compare(const_double_a,_const_double_b)_{_double_greatest_value_=_(fabs(a)_<_fabs(b))_?_fabs(b)_:_fabs(a);_return_fabs(a_b)_<=_(greatest_value_*_dbl_epsilon);_}_u64_eit_double_sign_bit(double_f)_{_u64_mask_=_1ull_<<_63;_u64_*comp_=_(u64_*)&f;_return_(*comp)_&_mask;_}_double_eit_radians_from_degrees(double_degrees)_{_double_radians_=_0.01745329251994329577f_*_degrees;_return_radians;_}_size_t_eit_mem_size_from_string(const_char_*size_str)_{_if_(!size_str_||_!*size_str)_{_return_0;_}_char_*end_ptr;_size_t_value_=_strtoull(size_str,_&end_ptr,_10);_if_(end_ptr_==_size_str)_{_return_0;_//_no_number_found_}_while_(isspace(*end_ptr))_{_end_ptr++;_}_if_(!*end_ptr)_{_return_value;_}_size_t_multiplier_=_0;_switch_(*end_ptr)_{_case_'t':_multiplier_=_1000ull_*_1000ull_*_1000ull_*_1000ull;_break;_case_'t':_multiplier_=_1024ull_*_1024ull_*_1024ull_*_1024ull;_break;_case_'g':_multiplier_=_1000ull_*_1000ull_*_1000ull;_break;_case_'g':_multiplier_=_1024ull_*_1024ull_*_1024ull;_break;_case_'m':_multiplier_=_1000ull_*_1000ull;_break;_case_'m':_multiplier_=_1024ull_*_1024ull;_break;_case_'k':_multiplier_=_1000ull;_break;_case_'k':_multiplier_=_1024ull;_break;_case_'b':_//_check_if_this_is_just_'b'_or_part_of_a_larger_unit_if_(end_ptr[1]_!=_'\0')_{_return_0;_}_else_{_multiplier_=_1;_}_break;_default:_return_0;_}_//_if_we_have_a_unit_letter,_verify_it's_followed_by_'b'_(except_for_plain_'b')_if_(*end_ptr_!=_'b'_&&_(end_ptr[1]_!=_'b'_||_end_ptr[2]_!=_'\0'))_{_return_0;_}_return_value_*_multiplier;_}_////////////////////////////////////////_//_logging_//_////////////////////////////////////////_/*_based_on_the_logging_frontend_i_wrote_for_oec_*/_i64_eit_write_log_(sdb_log_module_*module,_const_char_*log_level,_const_char_*fmt,_...)_{_if_(module_==_null)_{_return_0;_//_note(ingar):_if_the_log_module_is_null,_then_we_assume_logging_isn't_used_}_pthread_mutex_lock(&module_>lock);_time_t_posix_time;_struct_tm_time_info;_if_((time_t)(_1)_==_time(&posix_time))_{_return_errno;_}_if_(null_==_localtime_r(&posix_time,_&time_info))_{_return_errno;_}_u64_chars_written_=_0;_u64_buffer_remaining_=_module_>buffer_size;_int_format_ret_=_strftime(module_>buffer,_buffer_remaining,_"%t:_",_&time_info);_if_(0_==_format_ret)_{_//_note(ingar):_since_the_buffer_size_is_at_least_128,_this_should_never_happen_assert(format_ret);_return_enomem;_}_chars_written_=_format_ret;_buffer_remaining_=_format_ret;_format_ret_=_snprintf(module_>buffer_+_chars_written,_buffer_remaining,_"%s:_%s:_",_module_>name,_log_level);_if_(format_ret_<_0)_{_return_errno;_}_else_if_((u64)format_ret_>=_buffer_remaining)_{_//_note(ingar):_if_the_log_module_name_is_so_long_that_it_does_not_fit_in_128_bytes_the_//_time_stamp,_it_should_be_changed_assert(format_ret);_return_enomem;_}_chars_written_+=_format_ret;_buffer_remaining_=_format_ret;_va_list_va_args;_va_start(va_args,_fmt);_format_ret_=_vsnprintf(module_>buffer_+_chars_written,_buffer_remaining,_fmt,_va_args);_va_end(va_args);_if_(format_ret_<_0)_{_return_errno;_}_else_if_((u64)format_ret_>=_buffer_remaining)_{_(void)eit_memset(module_>buffer_+_chars_written,_0,_buffer_remaining);_format_ret_=_snprintf(module_>buffer_+_chars_written,_buffer_remaining,_"%s",_"message_dropped;_too_big");_if_(format_ret_<_0)_{_return_errno;_}_else_if_((u64)format_ret_>=_buffer_remaining)_{_assert(format_ret);_return_enomem;_}_}_chars_written_+=_format_ret;_module_>buffer[chars_written++]_=_'\n';_int_out_fd;_if_('e'_==_log_level[0])_{_out_fd_=_stderr_fileno;_}_else_{_out_fd_=_stdout_fileno;_}_if_((ssize_t)(_1)_==_write(out_fd,_module_>buffer,_chars_written))_{_return_errno;_}_pthread_mutex_unlock(&module_>lock);_return_0;_}_////////////////////////////////////////_//_memory_//_////////////////////////////////////////_void_*eit_memcpy(void_*_restrict_to,_const_void_*_restrict_from,_size_t_len)_{_//_note(ingar):_the_compiler_should_replace_this_with_memcpy_if_it's_available_for_(size_t_i_=_0;_i_<_len;_++i)_{_((u8_*)to)[i]_=_((u8_*)from)[i];_}_return_to;_}_void_*eit_memset(void_*_restrict_data,_int_set_to,_size_t_len)_{_//_note(ingar):_the_compiler_should_replace_this_with_memset_if_it's_available._don't_ask_me_why_//_you_cast_it_to_a_u8*_and_not_an_int*,_but_that_must_be_done_for_it_to_be_replaced_for_(size_t_i_=_0;_i_<_len;_++i)_{_((u8_*)data)[i]_=_set_to;_}_return_data;_}_bool_eit_memcmp(const_void_*lhs,_const_void_*rhs,_size_t_len)_{_//_note(ingar):_the_compiler_(probably)_won't_replace_this_one_with_memcmp,_but_gcc_didn't_//_replace_their_own_memcmp_implementation_with_a_call_to_memcmp,_so_that's_just_on_them_for_(size_t_i_=_0;_i_<_len;_++i)_{_if_(((u8_*)lhs)[i]_!=_((u8_*)rhs)[i])_{_return_false;_}_}_return_true;_}_void_eit_mem_zero(void_*_restrict_mem,_u64_size)_{_(void)eit_memset(mem,_0,_size);_}_void_/*_from_https://github.com/blake2/blake2/blob/master/ref/blake2_impl.h_*/_eit_mem_zero_secure(void_*mem,_u64_size)_{_//_note(ingar):_this_prevents_the_compiler_from_optimizing_away_memset._this_could_be_replaced_//_by_a_call_to_memset_s_if_one_uses_c11,_but_this_method_should_be_compatible_with_earlier_c_//_standards_static_void_*(*const_volatile_memset_v)(void_*,_int,_u64)_=_&memset;_(void)memset_v(mem,_0,_size);_}_void_eit_arena_init(sdb_arena_*arena,_u8_*mem,_u64_size)_{_arena_>cur_=_0;_arena_>cap_=_size;_arena_>mem_=_mem;_}_sdb_arena_*eit_arena_bootstrap(sdb_arena_*arena,_sdb_arena_*new_arena_,_u64_size)_{_sdb_arena_*new_arena;_if_(new_arena_==_null)_{_new_arena_=_eit_push_struct(arena,_sdb_arena);_}_else_{_new_arena_=_new_arena_;_}_u8_*new_arena_mem_=_eit_push_array(arena,_u8,_size);_if_(null_==_new_arena_||_null_==_new_arena_mem)_{_return_null;_}_eit_arena_init(new_arena,_new_arena_mem,_size);_return_new_arena;_}_//_todo(ingar):_create_aligning_pushes_void_*eit_arena_push(sdb_arena_*arena,_u64_size)_{_if_(arena_>cur_+_size_<=_arena_>cap)_{_u8_*alloced_mem_=_arena_>mem_+_arena_>cur;_arena_>cur_+=_size;_return_alloced_mem;_}_return_null;_}_void_*eit_arena_push_zero(sdb_arena_*arena,_u64_size)_{_if_(arena_>cur_+_size_<=_arena_>cap)_{_u8_*alloced_mem_=_arena_>mem_+_arena_>cur;_arena_>cur_+=_size;_eit_mem_zero(alloced_mem,_size);_return_alloced_mem;_}_return_null;_}_u64_eit_arena_remaining(sdb_arena_*arena)_{_return_arena_>cap_arena_>cur;_}_//_todo(ingar):_does_returning_the_position_add_overhead/is_it_necessary?_void_*eit_arena_pop(sdb_arena_*arena,_u64_size)_{_if_(arena_>cur_>=_size)_{_arena_>cur_=_size;_return_arena_>mem_+_arena_>cur;_}_return_null;_}_u64_eit_arena_get_pos(sdb_arena_*arena)_{_u64_pos_=_arena_>cur;_return_pos;_}_void_*eit_arena_seek(sdb_arena_*arena,_u64_pos)_{_if_(pos_<=_arena_>cap)_{_arena_>cur_=_pos;_return_arena_>mem_+_arena_>cur;_}_return_null;_}_u64_eit_arena_reserve(sdb_arena_*arena,_u64_size)_{_if_(arena_>cur_+_size_<=_arena_>cap)_{_arena_>cur_+=_size;_return_size;_}_else_{_return_eit_arena_remaining(arena);_}_}_void_eit_arena_clear(sdb_arena_*arena)_{_arena_>cur_=_0;_}_void_eit_arena_clear_zero(sdb_arena_*arena)_{_eit_mem_zero(arena_>mem,_arena_>cap);_arena_>cur_=_0;_}_void_eit_thread_arenas_init_(sdb_arena_*ta_buf[],_sdb_thread_arenas_*t_as,_sdb_thread_arenas_**ta_instance)_{_t_as_>arenas_=_ta_buf;_*ta_instance_=_t_as;_}_void_eit_thread_arenas_init_extern_(sdb_thread_arenas_*t_as,_sdb_thread_arenas_**ta_instance)_{_*ta_instance_=_t_as;_}_sdb_errno_eit_thread_arenas_add_(sdb_arena_*arena,_sdb_thread_arenas_*ta_instance)_{_if_(ta_instance_>count_+_1_<=_ta_instance_>max_count)_{_ta_instance_>arenas[ta_instance_>count++]_=_arena;_return_0;_}_return_1;_}_sdb_scratch_arena_eit_scratch_begin(sdb_arena_*arena)_{_sdb_scratch_arena_scratch;_scratch.arena_=_arena;_scratch.f5_=_eit_arena_get_pos(arena);_return_scratch;_}_sdb_scratch_arena_eit_scratch_get_(sdb_arena_**conflicts,_u64_conflict_count,_sdb_thread_arenas_*t_as)_{_sdb_arena_*arena_=_null;_if_(conflict_count_>_0)_{_for_(u64_i_=_0;_i_<_t_as_>count;_++i)_{_for_(u64_j_=_0;_j_<_conflict_count;_++j)_{_if_(t_as_>arenas[i]_!=_conflicts[j])_{_arena_=_t_as_>arenas[i];_goto_exit;_}_}_}_}_else_{_arena_=_t_as_>arenas[0];_}_exit:_return_(arena_==_null)_?_(sdb_scratch_arena){_0_}_:_eit_scratch_begin(arena);_}_void_eit_scratch_release_(sdb_scratch_arena_scratch)_{_eit_arena_seek(scratch.arena,_scratch.f5);_}_void_eit_array_shift(void_*mem,_u64_from,_u64_to,_u64_count,_u64_element_size)_{_if_(from_!=_to)_{_u8_*array_=_(u8_*)mem;_u8_*src_=_array_+_(from_*_element_size);_u8_*dst_=_array_+_(to_*_element_size);_u64_num_elements_=_(count_>_from)_?_(count_from)_:_0;_if_(num_elements_>_0)_{_u64_n_bytes_=_num_elements_*_element_size;_memmove(dst,_src,_n_bytes);_}_}_}_////////////////////////////////////////_//_strings_//_////////////////////////////////////////_u64_eit_strnlen(const_char_*string,_u64_max)_{_u64_count_=_0;_while_(*string++_!=_'\0'_&&_count_<_max)_{_++count;_}_return_count;_}_u64_eit_strlen(const_char_*string)_{_u64_count_=_0;_while_(*string++_!=_'\0')_{_++count;_}_return_count;_}_char_*eit_strdup(char_*string,_sdb_arena_*arena)_{_u64_string_length_=_eit_strlen(string);_char_*new_string_=_eit_push_array(arena,_char,_string_length_+_1);_eit_memcpy(new_string,_string,_string_length);_new_string[string_length]_=_'\0';_return_new_string;_}_//_//_eit_string_//_u64_eit_string_len(sdb_string_string)_{_return_eit_string_header(string)_>len;_}_u64_eit_string_cap(sdb_string_string);_u64_eit_string_cap(sdb_string_string)_{_return_eit_string_header(string)_>cap;_}_u64_eit_string_available_space(sdb_string_string)_{_sdb_string_header_*header_=_eit_string_header(string);_return_header_>cap_header_>len;_}_u64_eit_string_alloc_size(sdb_string_string)_{_u64_size_=_sizeof(sdb_string_header)_+_eit_string_cap(string);_return_size;_}_void_eit_string_set_len_(sdb_string_string,_u64_len)_{_eit_string_header(string)_>len_=_len;_}_void_eit_string_set_cap_(sdb_string_string,_u64_cap)_{_eit_string_header(string)_>cap_=_cap;_}_sdb_string_eit_string_make_(sdb_arena_*a,_const_void_*init_string,_u64_len)_{_size_t_header_size_=_sizeof(sdb_string_header);_void_*ptr_=_eit_arena_push(a,_header_size_+_len_+_1);_if_(ptr_==_null)_{_return_null;_}_if_(init_string_==_null)_{_eit_memset(ptr,_0,_header_size_+_len_+_1);_}_sdb_string_string;_sdb_string_header_*header;_string_=_(char_*)ptr_+_header_size;_header_=_eit_string_header(string);_header_>arena_=_a;_header_>len_=_len;_header_>cap_=_len;_if_(len_>_0_&&_(init_string_!=_null))_{_eit_memcpy(string,_init_string,_len);_string[len]_=_'\0';_}_return_string;_}_sdb_string_eit_string_make(sdb_arena_*a,_const_char_*string)_{_u64_len_=_(string_!=_null)_?_eit_strlen(string)_:_0;_return_eit_string_make_(a,_string,_len);_}_void_eit_string_free(sdb_string_string)_{_if_(string_!=_null)_{_sdb_string_header_*h_=_eit_string_header(string);_u64_pop_size_=_sizeof(sdb_string_header)_+_h_>cap_+_1;_eit_arena_pop(h_>arena,_pop_size);_}_}_sdb_string_eit_string_duplicate(sdb_arena_*a,_const_sdb_string_string)_{_return_eit_string_make_(a,_string,_sdb_string_len(string));_}_void_eit_string_clear(sdb_string_string)_{_eit_string_set_len_(string,_0);_string[0]_=_'\0';_}_void_eit_string_backspace(sdb_string_string,_u64_n)_{_u64_new_len_=_eit_string_len(string)_n;_eit_string_set_len_(string,_new_len);_string[new_len]_=_'\0';_}_sdb_string_eit_string_make_space(sdb_string_string,_u64_add_len)_{_u64_available_=_eit_string_available_space(string);_if_(available_<_add_len)_{_sdb_arena_*a_=_eit_string_header(string)_>arena;_u64_reserved_=_eit_arena_reserve(a,_add_len);_if_(reserved_<_add_len)_{_return_null;_}_u64_new_cap_=_eit_string_cap(string)_+_add_len;_eit_string_set_cap_(string,_new_cap);_}_return_string;_}_sdb_string_eit_string_append_(sdb_string_string,_const_void_*other,_u64_other_len)_{_string_=_eit_string_make_space(string,_other_len);_if_(string_==_null)_{_return_null;_}_u64_cur_len_=_eit_string_len(string);_eit_memcpy(string_+_cur_len,_other,_other_len);_eit_string_set_len_(string,_cur_len_+_other_len);_string[cur_len_+_other_len]_=_'\0';_return_string;_}_sdb_string_eit_string_append(sdb_string_string,_sdb_string_other)_{_return_eit_string_append_(string,_other,_sdb_string_len(other));_}_sdb_string_eit_string_append_c(sdb_string_string,_const_char_*other)_{_return_eit_string_append_(string,_other,_sdb_strlen(other));_}_sdb_string_eit_string_append_fmt(sdb_string_string,_const_char_*fmt,_...)_{_//_todo(ingar):_make_arena_mandatory_or_use_string's_arena?_char_buf[1024]_=_{_0_};_va_list_va;_va_start(va,_fmt);_u64_fmt_len_=_vsnprintf(buf,_eit_array_len(buf)_1,_fmt,_va);_//_todo(ingar):_stb_sprintf?_va_end(va);_return_eit_string_append_(string,_buf,_fmt_len);_}_sdb_string_eit_string_set(sdb_string_string,_const_char_*c_string)_{_u64_len_=_eit_strlen(c_string);_string_=_eit_string_make_space(string,_len);_if_(string_==_null)_{_return_null;_}_eit_memcpy(string,_c_string,_len);_string[len]_=_'\0';_eit_string_set_len_(string,_len);_return_string;_}_bool_eit_strings_are_equal(sdb_string_lhs,_sdb_string_rhs)_{_u64_l_string_len_=_eit_string_len(lhs);_u64_r_string_len_=_eit_string_len(rhs);_if_(l_string_len_!=_r_string_len)_{_return_false;_}_else_{_return_eit_memcmp(lhs,_rhs,_l_string_len);_}_}_////////////////////////////////////////_//_rng_//_////////////////////////////////////////_u32_*eit_get_pcg_state_(void)_{_static_uint32_t_eit_pcg_state_=_0;_return_&eit_pcg_state;_}_//_implementation_of_the_pcg_algorithm_(https://www.pcg_random.org)_//_it's_the_caller's_responsibilites_to_have_called_seed_rand_pcg_before_use_u32_eit_rand_pcg(void)_{_u32_state_=_*eit_get_pcg_state_();_*eit_get_pcg_state_()_=_state_*_747796405u_+_2891336453u;_u32_word_=_((state_>>_((state_>>_28u)_+_4u))_^_state)_*_277803737u;_return_(word_>>_22u)_^_word;_}_void_eit_seed_rand_pcg(uint32_t_seed)_{_*eit_get_pcg_state_()_=_seed;_}_/////////////////////////////////////////_//_file_io_//_/////////////////////////////////////////_void_eit_mem_unmap(sdb_mmap_*map)_{_if_(map_>data_!=_null_&&_map_>data_!=_map_failed)_{_munmap(map_>data,_map_>size);_}_if_(map_>fd_>=_0)_{_close(map_>fd);_}_}_sdb_errno_eit_mem_map_(sdb_mmap_*map,_void_*m_addr,_size_t_m_size,_int_m_prot,_int_m_flags,_int_m_fd,_off_t_m_offset,_sdb_string_file_name,_int_o_flags,_mode_t_o_mode,_sdb_log_module_*module)_{_map_>size_=_m_size;_map_>fd_=_1;_if_(m_fd_<_1)_{_if_(file_name)_{_map_>filename_=_file_name;_if_(!map_>filename)_{_eit_write_log_(module,_"err",_"failed_to_copy_filename:_%s",_strerror(errno));_goto_error;_}_}_map_>fd_=_open(file_name,_o_flags_&_(~o_trunc),_o_mode);_if_(map_>fd_==_1)_{_eit_write_log_(module,_"err",_"error_opening_file_%s:_%s",_file_name,_strerror(errno));_goto_error;_}_}_else_{_map_>fd_=_m_fd;_}_if_(o_flags_&_o_trunc_||_(m_flags_&_map_shared_&&_m_prot_&_prot_write))_{_if_(ftruncate(map_>fd,_m_size)_==_1)_{_eit_write_log_(module,_"err",_"error_setting_file_size:_%s",_strerror(errno));_goto_error;_}_if_(lseek(map_>fd,_0,_seek_set)_==_1)_{_eit_write_log_(module,_"err",_"error_resetting_file_pointer:_%s",_strerror(errno));_goto_error;_}_}_if_(m_flags_&_map_anonymous)_{_if_(map_>fd_!=_1)_{_close(map_>fd);_map_>fd_=_1;_}_}_map_>data_=_mmap(m_addr,_m_size,_m_prot,_m_flags,_map_>fd,_m_offset);_if_(map_>data_==_map_failed)_{_eit_write_log_(module,_"err",_"error_mapping_memory:_%s",_strerror(errno));_goto_error;_}_if_(m_flags_&_map_private)_{_if_(map_>fd_!=_1)_{_close(map_>fd);_map_>fd_=_1;_}_}_if_(m_flags_&_map_locked)_{_if_(mlock(map_>data,_m_size)_==_1)_{_eit_write_log_(module,_"warn",_"failed_to_lock_pages_in_memory:_%s",_strerror(errno));_}_}_return_0;_error:_eit_mem_unmap(map);_return_errno;_}_int_eit_mem_map_sync(sdb_mmap_*map)_{_int_ret_=_msync(map_>data,_map_>size,_ms_sync);_return_ret;_}_int_eit_mem_map_advise(sdb_mmap_*map,_int_advice)_{_int_ret_=_madvise(map_>data,_map_>size,_advice);_return_ret;_}_sdb_file_data_*eit_load_file_into_memory(const_char_*filename,_sdb_arena_*arena)_{_file_*file_=_fopen(filename,_"rb");_if_(!file)_{_printf("failed_to_open_file:_%s\n",_strerror(errno));_return_null;_}_if_(fseek(file,_0l,_seek_end)_!=_0)_{_fclose(file);_return_null;_}_u64_file_size_=_(u64)ftell(file);_rewind(file);_sdb_file_data_*file_data;_u64_file_data_size_=_sizeof(sdb_file_data)_+_file_size_+_1;_if_(null_!=_arena)_{_file_data_=_eit_arena_push(arena,_file_data_size);_}_else_{_file_data_=_calloc(1,_file_data_size);_}_if_(!file_data)_{_fclose(file);_return_null;_}_file_data_>size_=_file_size;_u64_bytes_read_=_fread(file_data_>data,_1,_file_size,_file);_if_(bytes_read_!=_file_size)_{_fprintf(stderr,_"failed_to_read_data_from_file_%s\n",_strerror(errno));_fclose(file);_if_(arena_!=_null)_{_eit_arena_pop(arena,_file_data_size);_}_else_{_free(file_data);_}_return_null;_}_fclose(file);_return_file_data;_}_bool_eit_write_buffer_to_file(void_*buffer,_u64_element_size,_u64_element_count,_const_char_*filename)_{_file_*fd_=_fopen(filename,_"wb");_if_(!fd)_{_fprintf(stderr,_"unable_to_open_file_%s!\n",_filename);_return_false;_}_bool_write_successful_=_fwrite(buffer,_element_size,_element_count,_fd)_==_element_count;_fclose(fd);_return_write_successful;_}_////////////////////////////////////////_//_"tokenizer"_//_////////////////////////////////////////_sdb_token_eit_get_next_token(char_**cursor)_{_while_('\t'_!=_**cursor)_{_(*cursor)++;_}_(*cursor)++;_//_skips_to_start_of_hex_number_sdb_token_token;_token.start_=_*cursor;_token.len_=_0;_while_('\n'_!=_**cursor_&&_'\r'_!=_**cursor)_{_(*cursor)++;_++token.len;_}_if_('\0'_!=_**cursor)_{_**cursor_=_'\0';_}_return_token;_}_////////////////////////////////////////_//_mem_trace_//_////////////////////////////////////////_void_*eit_malloc_trace_(size_t_size,_int_line,_const_char_*func,_sdb_log_module_*module)_{_void_*pointer_=_malloc(size);_eit_write_log_(module,_"dbg",_"malloc_(%s,%d):_%p_(%zd_b)",_func,_line,_pointer,_size);_return_pointer;_}_void_*eit_calloc_trace_(u64_element_count,_u64_element_size,_int_line,_const_char_*func,_sdb_log_module_*module)_{_void_*pointer_=_calloc(element_count,_element_size);_eit_write_log_(module,_"dbg",_"calloc_(%s,%d):_%p_(%lu_*_%lu_b_=_%zd_b)",_func,_line,_pointer,_element_count,_element_size,_(size_t)(element_count_*_element_size));_return_pointer;_}_void_*eit_realloc_trace_(void_*pointer,_size_t_size,_int_line,_const_char_*func,_sdb_log_module_*module)_{_void_*original_=_pointer;_void_*realloc_=_null;_if_(pointer_!=_null)_{_realloc_=_realloc(pointer,_size);_}_eit_write_log_(module,_"dbg",_"realloc_(%s,%d):_%p_>_%p_(%zd_b)",_func,_line,_original,_realloc,_size);_return_realloc;_}_void_eit_free_trace_(void_*pointer,_int_line,_const_char_*func,_sdb_log_module_*module)_{_eit_write_log_(module,_"dbg",_"free_(%s,%d):_%p",_func,_line,_pointer);_if_(pointer_!=_null)_{_free(pointer);_}_}_#if_(eit_mem_trace_==_1)_&&_(eit_log_level_>=_eit_log_level_dbg)_#define_malloc(size)_\_eit_malloc_trace_(size,_line_,_func_,_sdb_log_instance_)_#define_calloc(count,_size)_\_eit_calloc_trace_(count,_size,_line_,_func_,_sdb_log_instance_)_#define_realloc(pointer,_size)_\_eit_realloc_trace_(pointer,_size,_line_,_func_,_\_sdb_log_instance_)_#define_free(pointer)_\_eit_free_trace_(pointer,_line_,_func_,_sdb_log_instance_)_#endif_//_nolintend(misc_definitions_in_headers)_#endif_//_eit_h_implementation